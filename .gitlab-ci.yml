image: grafana/k6

stages:
  - test
  - report

test:
  stage: test
  variables:
    K6_OUT: influxdb=http://iam-qa-01.test.env:8086/testdb
  script:
    - k6 run ./scenarios/project/task.js --insecure-skip-tls-verify
  when: manual
  artifacts:
    when: always
    paths:
      - result.html
  tags:
    - test.env

pages:
  stage: report
  dependencies:
    - test
  script:
    - mkdir -p public
    - cp -r result.html public/
  artifacts:
    paths:
      - public
    expire_in: 14 days
  when: manual

